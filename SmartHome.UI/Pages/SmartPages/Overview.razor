@page "/smarthome/{SmartGuid}/overview"
@inherits SmartHomeGuidPage

@inject IDeviceService deviceService;
@inject ISnackbar snackBar;

@if (deviceList.Count <= 0)
{
    <MudText>You have no devices</MudText>
}

@foreach (Room room in roomList)
{
    List<Device> roomDeviceslist = deviceList.Where(d => d.RoomId == room.Id).ToList();
    //Ga door all rooms in de roomLists
    @if (roomDeviceslist.Count > 0)
    {
        //Zet room name op het scherm
        <MudText Typo="Typo.h3" Align="Align.Center">@room.Name</MudText>
        <MudDivider DividerType='DividerType.Middle' Class='my-6' />
        <MudPaper Class="d-flex d-inline-flex flex-grow-1 justify-center mb-4" Style="width: 100%; background-color: transparent;" Elevation="0">
            <MudPaper class="d-flex flex-wrap align-center gap-12 justify-space-between Apparaat-Container" Style="width: 90%; background-color: transparent;" Elevation="0">
                @for (int d = 0; d < roomDeviceslist.Count; d++)
                {
                    //Zet de apparaten op het scherm bij de room
                    switch (roomDeviceslist[d].Type)
                    {
                        case DeviceType.Lamp:
                            <Lamp Id="@roomDeviceslist[d].Id" Name="@roomDeviceslist[d].Name" config="@roomDeviceslist[d].JsonObjectConfig"></Lamp>
                            break;
                        case DeviceType.Televisie:
                            <Televisie Name="@roomDeviceslist[d].Name" Config="@roomDeviceslist[d].JsonObjectConfig"></Televisie>
                            break;
                        case DeviceType.Wasmachine:
                            <Wasmachine Name="@roomDeviceslist[d].Name" Config="@roomDeviceslist[d].JsonObjectConfig"></Wasmachine>
                            break;
                        case DeviceType.Router:
                            <Wifi_Router Id="@roomDeviceslist[d].Id" Name="@roomDeviceslist[d].Name" Config="@roomDeviceslist[d].JsonObjectConfig"></Wifi_Router>
                            break;
                    }
                }
            </MudPaper>
        </MudPaper>
    }
}

@code {
    List<Device> deviceList = new List<Device>();
    List<Room> roomList = new List<Room>();

    protected override async Task OnInitializedAsync()
    {
        var devices = await deviceService.GetAllDevices(new());
        if (devices.EnsureSuccess(snackBar))
            deviceList = devices.Devices;

        var rooms = await deviceService.GetAllRooms(new());
        if (rooms.EnsureSuccess(snackBar))
            roomList = rooms.Rooms;
    }
}